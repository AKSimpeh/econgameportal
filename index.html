<!doctype html>
<html>
<head>
  <title>Government Portal</title>
</head>
<body>
  <h1>Government Transparency Portal</h1>

  <nav>
    <a href="index.html">Home</a> |
    <a href="companies.html">Companies</a> |
    <a href="networth.html">Net Worth</a> |
    <a href="regulations.html">Regulations</a>
  </nav>

  <hr>

<h2>Announcements</h2>
<div id="announcements">Loadingâ€¦</div>

<script>
  const ANNOUNCEMENTS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTireKS1uTu8KNy29DCoZmXRDSDF10rIxF4cKRUFW12Lr9U_YHQRA9MH-vuK7M1VD-XjiTrnxE3oU4Y/pub?gid=870677309&single=true&output=csv";
  const REFRESH_MS = 15000;

  let lastRequestId = 0;

  function parseCSVSimple(text) {
    const lines = text.trim().split(/\r?\n/);
    const rows = [];
    for (let i = 1; i < lines.length; i++) {
      const [date, title, body] = lines[i].split(",");
      if (!date && !title && !body) continue;
      rows.push({
        date: (date || "").trim(),
        title: (title || "").trim(),
        body: (body || "").trim(),
      });
    }
    return rows;
  }

  async function loadAnnouncements() {
    const requestId = ++lastRequestId;
    const box = document.getElementById("announcements");

    try {
      const url = `${ANNOUNCEMENTS_CSV_URL}&_=${Date.now()}`;
      const res = await fetch(url, { cache: "no-store" });
      const text = await res.text();

      if (requestId !== lastRequestId) return;

      const rows = parseCSVSimple(text);
      rows.sort((a, b) => b.date.localeCompare(a.date));

      box.innerHTML = rows
        .map(
          (r) => `
        <div style="border:1px solid #ddd; padding:10px; margin:10px 0;">
          <div style="color:#555; font-size: 13px;">${r.date}</div>
          <div style="font-weight:700;">${r.title}</div>
          <div>${r.body}</div>
        </div>`
        )
        .join("");
    } catch (e) {
      if (requestId !== lastRequestId) return;
      box.innerHTML = `<p style="color:#b00020;">Failed to load announcements</p>`;
    }
  }

  loadAnnouncements();
  setInterval(loadAnnouncements, REFRESH_MS);
</script>



</body>
</html>


